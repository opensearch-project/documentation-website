---
layout: default
title: Service map
parent: Processors
grand_parent: Pipelines
nav_order: 330
---

# Service map processor

The `service_map` processor uses OpenTelemetry data to create a distributed service map for visualization in OpenSearch Dashboards.

The `service_map` processor generates a static service map and doesn't reflect the changes in the topology over time. The new [`otel_apm_service_map` processor]({{site.url}}{{site.baseurl}}/data-prepper/pipelines/configuration/processors/otel-apm-service-map/) provides a time-based service map.

## Configuration

The following table describes the option you can use to configure the `service_map` processor.

<!--
This table is autogenerated. Do not edit it.
- name: service_map
- pluginType: processor
- source: https://github.com/opensearch-project/data-prepper/blob/c4455a7785bc2da4358067c217be7085e0bc8d0f/data-prepper-plugins/service-map-stateful/src/main/java/org/opensearch/dataprepper/plugins/processor/ServiceMapProcessorConfig.java
-->

Option | Required | Type | Description
:--- | :--- | :--- | :---
`window_duration` | No | Integer | The fixed time window during which service map relationships are evaluated, in seconds. Default is `180`.

## Usage

```yaml
entry-pipeline:
   source:
     otel_trace_source:
       path: "/test/path"
   sink:
     - pipeline:
         name: "raw-pipeline"
     - pipeline:
         name: "service-map-pipeline"
raw-pipeline:
   source:
     pipeline:
       name: "entry-pipeline"
   processor:
     - otel_trace_raw:
   sink:
     - opensearch:
         hosts: [<host>]
         index_type: trace-analytics-raw
service-map-pipeline:
   source:
     pipeline:
       name: "entry-pipeline"
   processor:
     - service_map_stateful:
         window_duration: 60s
   sink:
     - opensearch:
         hosts: [<host>]
         index_type: trace-analytics-service-map
```
{% include copy.html %}

## Metrics

The following table describes common [Abstract processor](https://github.com/opensearch-project/data-prepper/blob/main/data-prepper-api/src/main/java/org/opensearch/dataprepper/model/processor/AbstractProcessor.java) metrics.

| Metric name | Type | Description |
| ------------- | ---- | -----------|
| `recordsIn` | Counter | The ingress of records to a pipeline component. |
| `recordsOut` | Counter | The egress of records from a pipeline component. |
| `timeElapsed` | Timer | The time elapsed during execution of a pipeline component. |

The `service_map` processor includes the following custom metrics.

| Metric name | Type | Description |
| ------------- | ---- | -----------|
| `spansDbSize` | Gauge | The total size of both current and previous span database windows, in bytes. |
| `spansDbCount` | Gauge | The total number of span entries across both current and previous span database windows. |
| `traceGroupDbSize` | Gauge | The total size of both current and previous trace group database windows, in bytes. |
| `traceGroupDbCount` | Gauge | The total number of trace group entries across both current and previous trace group database windows. |
| `relationshipCount` | Gauge | The total number of unique service map relationships discovered and stored in the relationship state. |
